# 2 일차 러버덕

## 주제

- 실행컨텍스트(Execution Context)
- this(부주제)

## 공부하면서 알게된 부수적인 사실들

### 왜 ECMAscript 표준이 필요한 이유는 무엇이고 왜 따르는가??

- 대부분의 JS 는 ECMAscript 로 standard 되어 있는데 그 이유는 아래와 같다.
- 여기서 ECMA-262 는 Ecma International 에서 출판 한 표준 262 는 reference 번호인데.
  여기에는 범용 스크립팅 언어에 대한 사양이 포함되어 있습니다.(262 는 2017 년 6 월 출판한 8th Edition 인데 현재 진행중인 작업의 최신판이다.)

- 왜 ECMAscript 가 표준인가??
  > Javascript 가 처음 Netscape 에 의해 작성되었을 때 시장의 모든 브라우저 공급 업체간에 전쟁이있었습니다.
  > Microsoft 는 Internet Explorer 에서 자체 JavaScript 버전인 J 스크립트를 구현했습니다. 마찬가지로 다른 브라우저 공급 업체에서도 자체 버전을 구현했습니다.
  > 이것이 개발자들에게 커다란 문제를 야기 시켰는데, 한 코드는 넷스케이프에서 잘 돌아 갔지만 인터넷 익스플로러에서는 문제가 있던 크로스 브라우징의 문제가 생겼고
  > 크로스 브라우저 호환성을 해결하기 위해 넷스케이프 측에서 규정을 요청, Javascript 는 ECMA international 에 의해 표준화되었습니다.
  > 이것이 `ECMAscript` 입니다.
  > 모든 브라우저는 ECMA 스크립트를 구현하기로 동의해 갔고 (많은 시간이 걸렸지 만).
  > 결과는 이제 모든 브라우저에서 동일한 코드가 올바르게 실행됩니다.
  > 예외는 DOM (문서 개체 모델)입니다.
  > DOM 은 다른 브라우저에서 여전히 다른 방식으로 해석되지만 모든 브라우저가 서서히 동일한 DOM 표준을 고수해 가고 있다.

## 실행 컨텍스트란 무엇인가?

- 실행 콘텍스트(Execution context, 이하 EC)는 실행 가능한 코드(3 가지)의 유형을 나누고 구별하기 위해서, ECMA-262 스펙이 정의하고 있는 추상적인 개념이다.
- 여기서 실행 가능한 코드는 3 가지 이다.
  > - 전역 코드(Global Code) : 전역영역에 존재하는 코드
  > - 함수 코드(Function Code) : 함수 영역 내 존재하는 코드
  > - eval 코드(eval Code) : eval 함수 내 존재하는 코드(보안상의 치명적인 문제가 있어 잘 안씀)
- 이 중에 실행 가능한 코드는 전역코드와 함수코드이다.
- 실행에 필요한 정보를 형상화하고 구분하기 위해 자바스크립트 엔진은 실행 컨텍스트를 물리적 객체의 형태로 관리하는데 그에 필요한 정보는 아래와 같다.
  > - 변수 : 전역변수, 지역변수, 매개변수(parameter), 객체의 프로퍼티(property)
  > - 함수 선언
  > - 변수의 유효범위(scope)
  > - this
- 실행 컨텍스트는 스택 구조에 의해 생성 되고 소멸된다. 실행중인 컨텍스트에서 관련없는 또 다른 코드가 실행되면 새로운 컨텍스트가 생성되어 쌓이게 되고 이 컨텍스트는 제어권이 넘어가게 된다.
- 제일 먼저 전역 실행 컨텍스트가 쌓여지고 해당 전역 컨텍스트는 애플리케이션이 실행 종료 될 때 까지 유지된다.
- 함수를 호출하면 함수 컨텍스트가 스택에 쌓여지게 되고 해당 컨텍스트는 실행이 종료가 되면 파기 되고 직전의 실행 컨텍스트의 제어권이 반환된다.

## 실행 컨텍스트 내부의 속성 동작 원리

- 활성화 된 실행 컨텍스트들은 스택의 형태를 구성하고 있다. 스택의 바닥(bottom)에는 항상 전역 문맥(global context)이 위치하고, 꼭대기(top)에는 현재(활성화되어 있는)의 실행 콘텍스트가 자리를 잡는다. 스택은 다양한 종류의 실행 콘텍스트가 들어오고 나가면서 변경(pushed/popped)된다. (`First out Last in`)

- 실행에 필요한 정보를 형상화하고 구분하기 위해 자바스크립트 엔진은 실행 컨텍스트를 물리적 객체의 형태로 관리.
- 실행 컨텍스트는 실행 가능한 코드를 형상화하고 구분하는 추상적인 개념이지만 물리적으로는 객체의 형태를 가지며 아래의 3 가지 프로퍼티를 소유(실행에 필요한 정보를 파악하기 위해 진행되는 속성)
  > - VO(Variable Object)
      - 변수
      - 매개변수(parameter), 인수정보(arguments)
      - 함수 선언(함수 표현식 제외)
  > - SC(Scope Chain)
  > - thisValue(Context Object)

### Variable Object(V/O) 란?

- VO 안에 실행에 필요한 정보들이 있는데 자바스크립트 엔진은 코드를 실행하기 위하여 실행에 필요한 여러가지 정보를 알고 있어야 하는데 그것은 다음과 같다.
  > - 변수
  > - parameter, arguments
  > - 함수선언(함수 표현식 제외)
- VO(variable object)에서 함수 실행시 가르키는 객체 단위는 2 가지인데 `전역 컨텍스트`, `함수 컨텍스트`로 나눠진다.
- `전역 컨텍스트`의 경우 전역 변수/전역 함수 등을 포함한 전역 객체를 가르키고 이객체는 `전역에 선언된 전역변수와 전역함수`를 `프로퍼티로 소유`한다.
- `함수 컨텍스트`의 경우 활성객체라 불리는 Activation Object 를 가르키며 `매개변수`와 `인수들의 정보`를 `배열형태`로 담고 있는 객체인 `arguments Object`가 추가된다.

### 변수 객체화 과정에서 호이스팅이 함수 선언식과 표현식중 어느것이 발생되는가?

- 선언식 이유는 알수 없으나 표현식에서는 발생되지 않는다고 함

### 실행 컨텍스트의 Scope Chain 의 작동 원리는?

- 일반적으로 함수 단위일 때 함수가 중첩함수일 때 상위함수의 유효범위까지 탐색해 참조하는 기능이다.
- 실행 컨텍스트에서 Scope Chain 이란 중첩된 함수의 스코프(변수의 참조범위)의 레퍼런스를 차례로 저장하고 있는 개념이다.
- 이 Scope Chain 은 `해당 전역 또는 함수가 참조 할 수 있는 변수, 함수선언` 등의 정보를 담고 있는 `Global Object` 또는 `Activation Object` 를 가르킨다
- Activation Object 를 선두로 해서 순차적으로 상위 컨텍스트의 활성 객체를 가르키고 마지막 리스트는 Global Object 를 가르킨다(왜냐하면 Stack 구조에 의해 제일 먼저 쌓여지는건 Global Object 이기 때문이고 나중에 나가게 된다 `Last Out First In`)
- 즉 해당 변수를 현재의 scope 인 A/O 에서 검색 후 검색에 실패시 다음 리스트가 가르키는 A/O 를 검색한다 이와 같이 변수를 검색 하는데 실패하게 되면 정의 되지 않은 변수의 접근으로 판단 되어 Reference Error 를 발생한다.

### 실행 컨텍스트의 this 란? 무엇인가?

- this 는 실행 콘텍스트의 프로퍼티다.
- 실행 컨텍스트에서 this 값이 할당 되는데 this 는 실행된 후 할당되는 값은 함수 호출 패턴에 의해 결정된다
- 그 패턴은 다음 4 가지로 요약할 수있다.
  > - 함수 호출 패턴(Function Invocation Pattern)
  > - 메소드 호출 패턴(Method Invocation Pattern)
  > - 생성자 호출 패턴(Constructor Invocation Pattern)
  > - apply 호출 패턴(Apply Invocation Pattern)

## 실행 컨텍스트의 생성 과정은?

1.  실행 컨텍스트 진입전 G/O(Global Object) or A/O(Activation Object) 가 먼저 생성되고 G/O 의 경우 코드의 어떠한 곳에서든 접근이 가능하다.
2.  G/O 생성후 전역 코드로 진입하게 되면 전역 실행 컨텍스트가 생성되고 실행 컨텍스트가 스택에 쌓인다.
3.  그 다음 스코프 체인이 생성되고 초기화가 실행 되는데 이때 스코프 체인은 전역객체의 레퍼런스에 포함 하는 리스트가 된다.
4.  스코프 체인의 생성과 초기화가 종료하면 변수 객체화(Variable Instantiation)가 실행된다.
5.  변수 객체화는 Variable Object 에 프로퍼티와 값을 추가하는 것을 의미하는데 변수, 매개변수와 인수 정보(arguments), 함수 선언을 Variable Object 에 추가하여 객체화하기 때문이다.
6.  해당 변수 객체화는 함수 선언 과 함수 안에 변수를 순차적으로 선언 처리를 하게 되고
7.  객체화 안의 변수 선언 처리가 끝나면 다음은 this value 가 결정된다 이 때 this 가 가르키는 범위는 전역 객체이고 함수의 호출 패턴에 의해 this 가 결정된다.
8.  이후 값을 할당 및 실행을 진행하게 되고
9.  1)스코프 체인의 생성과 초기화, 2)Variable Instantiation 실행, 3)this value 결정 순으로 진행되고 다음 컨텍스트로 제어권이 넘어가고 실행되게 된다.

## 회고

- 주제를 정하고 질문하기 전 인터뷰 레퍼런스를 참고해 질문을 정리하는 방식도 좋다고 생각함.

## 다음 주제

- prototype
  <!-- - arrow Func / Func 차이 -->
